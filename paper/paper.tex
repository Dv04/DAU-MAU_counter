\documentclass[11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[a4paper,margin=1in]{geometry}
\usepackage{amsmath,amsfonts,amssymb}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage[numbers,sort&compress]{natbib}
\usepackage{url}
\usepackage[strings]{underscore}
\usepackage{hyperref}

\title{Erasure-Compliant, Differentially Private Distinct Counting under Continual Observation:\\
A Flippancy-Aware System with Edge-to-Cloud Deployment and a CCTV Case Study}
\author{Dev Sanghvi \\ Rice University}
\date{{\small Draft: {{PAPER_DATE}}}}

\begin{document}
\maketitle

\begin{abstract}
Distinct-count analytics (e.g., DAU/MAU-style metrics) are central to product analytics, IoT telemetry, ads reach, finance risk signals, and more. These settings increasingly require \emph{both} meaningful privacy guarantees and the ability to honor erasure requests (GDPR/CCPA). We present an erasure-compliant, differentially private (DP) pipeline for \emph{distinct} counting in \emph{turnstile} streams (insertions and deletions) under \emph{continual release}. The system combines: (i) \textbf{pseudonymization} with rotating salts; (ii) \textbf{Theta sketches} with union and \emph{A-not-B} for efficient per-period and rolling-window distinct counting with deletions; and (iii) a \textbf{flippancy-aware} DP release mechanism calibrated for item-level privacy over time. We implement a working prototype with REST APIs, a privacy accountant, and synthetic workloads. Results show that at $\epsilon={{EPSILON_DAU}}$ (daily) and $\epsilon={{EPSILON_MAU}}$ (monthly), additive error is within {{ERROR_PCT}}{\%} and ingestion sustains {{THROUGHPUT}} events/s on a commodity machine (placeholders). We discuss budget governance, deletion replay, and sketch choices (Theta vs.\ HLL++ rebuilds). To illustrate deployability, we include a brief \emph{CCTV} case study as one application among many, without narrowing the generality of the approach.
\end{abstract}

\section{Introduction}
Distinct-count metrics such as daily or rolling-window ``active entities'' appear across domains: web/mobile user analytics, IoT fleet monitoring, ads reach, financial risk telemetry, and physical-space analytics. These analytics are increasingly subject to privacy expectations and erasure laws (e.g., GDPR Art.~17) \cite{GDPR}. Releasing counts continually (e.g., daily) raises composition concerns, and supporting deletions turns the problem into a \emph{turnstile} stream.

Differential Privacy (DP) \cite{Dwork2006} bounds any single subject's influence by adding calibrated noise. Recent theoretical progress addresses \emph{distinct counting with deletions} under continual observation via the \emph{flippancy} parameter $w$---the maximum number of presence/absence flips per subject---achieving error $\tilde{O}(\sqrt{w})$ at item-level DP and proving tight lower bounds for event-level DP \cite{Flippancy2023}.

We contribute a practical, end-to-end pipeline for erasure-compliant, DP \emph{distinct} analytics that is domain-agnostic:

\begin{itemize}
    \item \textbf{Pseudonymization with rotating salts.} Transform short-lived identifiers (e.g., app/device IDs, IoT sensor tokens) into \emph{period-scoped salted hashes}; retain no raw identities.
    \item \textbf{Sketch-based distinct counting.} Use \emph{Theta} sketches for per-period distincts and rolling-window unions; support deletions via \emph{A-not-B}. Contrast with HLL++ (merge-only; no native delete) \cite{Flajolet2007,DataSketches,DataSketchesANotB}.
    \item \textbf{Flippancy-aware DP releases.} Daily distincts and $W$-day MAW (monthly active whatever) with Laplace/Gaussian noise scaled for item-level DP; a privacy accountant tracks composition; deterministic per-period noise prevents query averaging \cite{Dwork2006,Rogers2020}.
\end{itemize}

We implement a prototype with a REST service, a budget ledger, and synthetic workloads. Placeholders indicate where figures slot in. The design generalizes across domains; we include a short \emph{CCTV case study} to demonstrate deployment in a high-sensitivity setting while keeping the paper's contribution general.

\paragraph{Contributions.}
(1) A deployment-ready \emph{edge$\to$cloud} recipe for erasure-aware DP distinct counting across domains; (2) a sketch layer with \emph{A-not-B} to operationalize deletions; (3) a continual-release DP mechanism and budget service tuned to flippancy; (4) an evaluation plan and operational guidance for compliance-ready rollouts; (5) a brief case study instantiation in CCTV.

\section{Background and Related Work}
\paragraph{Differential Privacy and composition.}
DP bounds output distribution changes from any single subject \cite{Dwork2006}. Repeated releases compose; basic composition sums $\epsilon$, while advanced analyses (e.g., R\'enyi DP) tighten bounds. Deterministic per-query/per-period noise seeds prevent adversarial re-query averaging \cite{Rogers2020}. NIST SP~800-226 offers guidance for documenting DP claims \cite{NIST800226}.

\paragraph{Turnstile distinct counting with deletions.}
Under continual observation with deletions, event-level DP faces strong lower bounds; \emph{flippancy} $w$ enables item-level DP with additive error $\tilde{O}(\sqrt{w})$ \cite{Flippancy2023}. Many telemetry workloads naturally bound $w$ via coalescing (e.g., one presence per subject per period).

\paragraph{Distinct sketches.}
HyperLogLog (HLL/HLL++) estimates distincts with small memory but is \emph{append-only} (no deletions) \cite{Flajolet2007}. Theta (KMV) sketches support \emph{union}, \emph{intersection}, and \emph{A-not-B} (set difference) \cite{Dasgupta2016,DataSketches,DataSketchesANotB}. For large sets, order-invariant cardinality estimators can exhibit inherent DP-like behavior, though we still add explicit DP noise \cite{Dickens2023}.

\paragraph{Adjacent privacy systems.}
Deployed DP analytics systems (e.g., LinkedIn's Audience Engagements) pair user-level DP with budget governance and deterministic noise \cite{Rogers2020}. Video-focused DP systems (VideoDP, Privid) address other query classes; our work targets \emph{distinct under deletions} with continual releases \cite{VideoDP2020,Privid2022}.

\section{Problem Formulation}
We consider many sources (apps/devices/sensors/zones) generating subject activity. For period $t$, define $S_t$ as the set of (pseudonymous) subjects active that period. DAU-like metric: $\mathrm{DA}(t)=|S_t|$. For a window $W$ (e.g., 30 days), MAW-like metric:
\[
\mathrm{MA}(t)=\Bigl|\bigcup_{i=t-W+1}^{t} S_i\Bigr|.
\]
\textbf{Privacy.} Item-level DP protects a subject's \emph{entire} trace. We release DA/MA once per period with $(\epsilon_t,\delta_t)$, tracking composition.

\textbf{Turnstile and deletions.} Insertions add a subject to $S_t$; erasures request removing a subject from all $S_i$ where present. We maintain updated sets/sketches and ensure future releases reflect removals.

\textbf{Flippancy.} Let $w$ bound per-subject flips across the horizon; period coalescing keeps $w$ small in many telemetry workloads.

\section{System Overview (Edge \texorpdfstring{$\to$}{->} Cloud)}
\subsection*{Edge/Device}
\textbf{Pseudonymization.} For a short-lived signal (e.g., app/device token) $x$, compute
\[
\mathrm{subject\_key} = H(x \,\|\, \mathrm{salt}_{\mathrm{period}})
\]
with a rotated salt; drop $x$. Maintain a per-period Theta sketch $T_t$ (or exact set for small loads). Upload sketch bytes (or DP'd scalar).

\subsection*{Gateway/Site}
Union per-source period sketches into site-level $T^{\mathrm{site}}_t$. Maintain a rolling union $U_t = \mathrm{Union}(T_{t-W+1},\ldots,T_t)$.
For erasure of subject $u$ across days $\mathcal{D}$, construct $U^{(u)}_d$ (tiny sketches containing $u$ for each $d\in\mathcal{D}$) and apply $T_d \leftarrow \mathrm{AminusB}(T_d, U^{(u)}_d)$; update $U_t$ accordingly.

\subsection*{Cloud/Tenant}
Aggregate site sketches (unions), apply DP release (Section~\ref{sec:algorithms}), and log to a privacy budget ledger (metric, period, $\epsilon,\delta$, seed).

\section{Algorithms}\label{sec:algorithms}
\paragraph{Sketch layer.}
Backends:
\begin{itemize}
    \item \emph{Theta (preferred):} union/intersection/A-not-B; size $k$ controls RSE. Efficient for rolling windows and deletions \cite{Dasgupta2016,DataSketchesANotB}.
    \item \emph{Exact sets (baseline):} for small loads/testing.
    \item \emph{HLL++ (optional):} union-only; deletions require period-level rebuild from a light index \cite{Flajolet2007}.
\end{itemize}

\paragraph{DP continual release.}
For count $f_t$ (DA or MA on period $t$), with item-level sensitivity $\Delta=1$, release
\[
\tilde{f}_t = f_t + \eta_t,\qquad \eta_t \sim \mathrm{Lap}\!\left(\tfrac{\Delta}{\epsilon_t}\right).
\]
Use deterministic, per-(metric,period) seeding to prevent averaging via re-queries \cite{Rogers2020}. A budget service records $(t,\epsilon_t,\delta_t)$ and enforces caps. For tighter composition, swap to Gaussian/RDP.

\paragraph{Deletion replay.}
On erasure of subject $u$:
(1) identify periods $\mathcal{D}$; (2) remove $u$ from $T_d$ via A-not-B (Theta) or rebuild (HLL++); (3) update window unions; (4) future releases use updated values with fresh noise. Historical releases are not retroactively DP-redactable; treat as superseded (operational policy).

\section{Implementation}
Python 3.11 prototype (FastAPI service, SQLite ledger). Modules:
\begin{itemize}
    \item \texttt{sketches/}: Theta backend (via DataSketches) and exact sets.
    \item \texttt{pipeline.py}: period stores, rolling unions, deletions, DP releases.
    \item \texttt{privacy\_accountant.py}: budget ledger; basic composition; warnings on cap.
    \item \texttt{routes.py}: \texttt{POST /event}, \texttt{GET /dau/\{day\}}, \texttt{GET /mau/\{day\}}.
    \item \texttt{auth.py}: optional API key.
\end{itemize}
\textbf{Noise seeding.} PRNG seeded by secret $s$ and key $(\mathrm{metric},\mathrm{period})$; rotate $s$ periodically. \textbf{Windows.} Maintain last $W={{MAU_WINDOW_DAYS}}$ periods (drop older). \textbf{Edge.} On constrained devices, emit per-hour sets to gateway which compacts to per-period sketches.

\section{Evaluation (placeholders)}\label{sec:evaluation}
We outline the study; concrete numbers/plots are placeholders to be filled.

\paragraph{Setup.}
Synthetic telemetry over ${{EVAL_DAYS}}$ periods; $N={{N_USERS}}$ subjects; per-period active {{DAILY_ACTIVE}}; overlap {{REPEAT_RATE}}\%. Deletions: start period {{DELETE_START}}, remove {{DELETE_COUNT}} subjects spread across prior periods.

\paragraph{Metrics.}
(1) \textbf{Accuracy:} MAE/relative error for DA/MA under $\epsilon={{EPSILON_DAU}},{{EPSILON_MAU}}$; (2) \textbf{Sketch impact:} Theta vs exact; (3) \textbf{Deletions:} correctness of replay and effect on MA; (4) \textbf{Latency/Throughput:} p50/p99 and ingestion rate.

\paragraph{Results (to be inserted).}
\begin{itemize}
    \item \textbf{Noise accuracy:} mean DA MAE $={{DAU_MAE}}$ (\% error $={{DAU_REL_ERR}}\%$); MA rel. error $={{MAU_REL_ERR}}\%$. Figure~{{FIG_NOISE_ACCURACY}}.
    \item \textbf{Sketch vs exact:} RSE $\approx$ {{THETA_RSE}}\% at $k={{THETA_K}}$; scatter near diagonal (Fig.~{{FIG_SKETCH_VS_EXACT}}).
    \item \textbf{Deletions:} post-erasure MA drops consistent with removed subjects $\,\pm\,$ DP noise (Table~{{TAB_DELETE}}).
    \item \textbf{Performance:} ingestion {{THROUGHPUT}} events/s; queries $<{{QUERY_LAT_MS}}$ ms p99 (Fig.~{{FIG_PERF}}).
\end{itemize}

\section{Case Study: CCTV Analytics (Brief)}
As one concrete instantiation, we apply the pipeline to occupancy/footfall analytics in CCTV:
\begin{itemize}
    \item \textbf{Edge pseudonymization:} daily-salted hashes of track/plate tokens on camera/NVR; no raw identities retained.
    \item \textbf{Sketches at gateway:} per-day Theta sketches per camera/zone; site-level unions; rolling 30-day MAU via union; deletions via \emph{A-not-B}.
    \item \textbf{DP releases and ledger:} daily DAU and 30-day MAU with published $(\epsilon,\delta)$; budget accounting and deterministic per-day noise.
\end{itemize}
Operational notes: Theta eases deletions; HLL++ requires day-rebuilds. Salt rotation breaks long-term linkability; retention windows align with data minimization. (Evaluation uses the same metrics as Section~\ref{sec:evaluation}, with CCTV-like workloads; placeholders apply.)

\section{Discussion}
\textbf{Theta vs HLL++.} Theta’s A-not-B simplifies deletions and rolling windows; HLL++ suits union-only or rebuild-on-delete pipelines \cite{Flajolet2007,DataSketchesANotB}. \textbf{Budgeting.} Expose customer-visible $\epsilon$ tiers; allocate budget across DA vs MA. \textbf{Deployment.} Edge pseudonymization generalizes to SDKs/mobile, IoT gateways, and NVRs.

\section{Limitations and Threats to Validity}
Assumptions on identifier stability and coalescing bound flippancy; synthetic traces may miss domain idiosyncrasies; sketch adversarial inputs and hash collisions; noise-seed handling and multi-instance coordination.

\section{Ethics and Compliance}
No raw identities beyond transient signals; period salt rotation; erasure SLAs; DP documentation and audit via \cite{NIST800226}; DPIA/IRB if evaluating on human-subject traces.

\section{Conclusion}
We presented a domain-agnostic, erasure-compliant DP pipeline for distinct analytics under continual release. By combining pseudonyms, Theta sketches, and flippancy-aware DP releases with a budget service, we deliver useful DA/MA metrics while honoring deletions. Future work: tree-aggregation for smoother continual releases, RDP accounting, federated deployments, and large-scale evaluations; extended case studies (ads reach, IoT fleets).

\begin{thebibliography}{99}

\bibitem{GDPR}
European Parliament and Council. \emph{General Data Protection Regulation (EU) 2016/679 (GDPR)}, 2016.

\bibitem{Dwork2006}
C.~Dwork, F.~McSherry, K.~Nissim, A.~Smith.
Calibrating noise to sensitivity in private data analysis.
In \emph{TCC}, 2006.

\bibitem{Flippancy2023}
(Authors). Counting Distinct Elements in the Turnstile Model with Differential Privacy under Continual Observation. \emph{NeurIPS}, 2023. (arXiv:2306.06723).

\bibitem{Rogers2020}
R.~Rogers et al.
LinkedIn's Audience Engagements API: A Privacy Preserving Data Analytics System at Scale.
arXiv:2002.05839, 2020.

\bibitem{Flajolet2007}
P.~Flajolet, \'{E}.~Fusy, O.~Gandouet, F.~Meunier.
HyperLogLog: the analysis of a near-optimal cardinality estimation algorithm.
\emph{AOFA}, 2007.

\bibitem{Dasgupta2016}
A.~Dasgupta, K.~J.~Lang, L.~Rhodes, J.~Thaler.
A Framework for Estimating Stream Expression Cardinalities.
\emph{ICDT}, 2016.

\bibitem{DataSketches}
Apache DataSketches Project. Theta Sketches Documentation. \url{https://datasketches.apache.org/}, accessed {{ACCESS_DATE}}.

\bibitem{DataSketchesANotB}
Apache DataSketches. A-not-B and Set Operations for Theta Sketches. \url{https://datasketches.apache.org/}, accessed {{ACCESS_DATE}}.

\bibitem{Dickens2023}
C.~Dickens, J.~Thaler, D.~Ting.
Order-Invariant Cardinality Estimators Are Differentially Private.
\emph{SODA}, 2023.

\bibitem{VideoDP2020}
(Authors). VideoDP: A Platform for Differentially Private Video Analytics. \emph{PoPETs}, 2020.

\bibitem{Privid2022}
(Authors). Privid: Practical, Privacy-Preserving Video Analytics Queries. \emph{NSDI}, 2022.

\bibitem{NIST800226}
NIST Special Publication 800-226. \emph{A Taxonomy and Terminology of Differential Privacy Mechanisms and Applications}. 2025.

\end{thebibliography}

\appendix
\section*{Appendix A: Placeholders and How to Complete the Paper}
Replace every token below (search for the exact token text):

\begin{itemize}
    \item \textbf{{{PAPER_DATE}}}: Draft date (e.g., ``October 2025'').
    \item \textbf{{{ACCESS_DATE}}}: Date you accessed online documentation pages.
    \item \textbf{{{MAU_WINDOW_DAYS}}}: Window length (default 30).
    \item \textbf{{{EPSILON_DAU}}}, \textbf{{{EPSILON_MAU}}}, \textbf{{{DELTA}}}: Privacy parameters used in evaluation.
    \item \textbf{{{ERROR_PCT}}}: Overall relative error summary (e.g., ``2'').
    \item \textbf{{{THROUGHPUT}}}: Ingestion throughput (events/s).
    \item \textbf{{{QUERY_LAT_MS}}}: Query latency (ms).
    \item \textbf{{{EVAL_DAYS}}}, \textbf{{{N_USERS}}}, \textbf{{{DAILY_ACTIVE}}}, \textbf{{{REPEAT_RATE}}}: Synthetic trace parameters.
    \item \textbf{{{DELETE_START}}}, \textbf{{{DELETE_COUNT}}}: Deletion scenario parameters.
    \item \textbf{{{DAU_MAE}}}, \textbf{{{DAU_REL_ERR}}}, \textbf{{{MAU_REL_ERR}}}: Accuracy metrics.
    \item \textbf{{{THETA_K}}}, \textbf{{{THETA_RSE}}}: Theta sketch configuration and nominal RSE.
    \item \textbf{{{FIG_NOISE_ACCURACY}}}, \textbf{{{FIG_SKETCH_VS_EXACT}}}, \textbf{{{FIG_PERF}}}, \textbf{{{TAB_DELETE}}}: Figure/table labels; add environments or remove references.
    \item \textbf{{{ARCH_DIAGRAM_PATH}}}: If adding an architecture diagram figure (optional).
\end{itemize}

\paragraph{To finalize for submission:}
(1) Fill placeholders and insert figures/tables; (2) ensure all citations have full bibliographic details (replace ``(Authors)'' with actual author lists if needed); (3) compile and check for warnings; (4) remove this appendix section if the venue discourages placeholder notes; (5) adopt the venue’s LaTeX class if required (ACM/IEEE).

\end{document}
